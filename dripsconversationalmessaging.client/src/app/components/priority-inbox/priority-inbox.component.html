<section class="inbox-container">
  <header class="inbox-header">
    <div>
      <h2>Priority Inbox</h2>
      <p class="subtitle">
        Frustrated customers requiring immediate attention.
        Auto-refreshes every 10 s.
      </p>
    </div>
    <button class="btn-secondary" (click)="refresh()" [disabled]="messaging.loadingPriority()">
      @if (messaging.loadingPriority()) { Loading… } @else { ↻ Refresh }
    </button>
  </header>

  @if (messaging.priorityError()) {
    <div class="alert alert-error" role="alert">{{ messaging.priorityError() }}</div>
  }

  @if (!messaging.loadingPriority() && messaging.conversations().length === 0) {
    <div class="empty-state" role="status">
      <span class="empty-icon">✓</span>
      <p>No high-priority conversations right now.</p>
    </div>
  }

  <ul class="conversation-list" aria-label="High-priority conversations">
    @for (conv of messaging.conversations(); track conv.id) {
      <li class="conversation-card">
        <div class="conv-header">
          <span class="phone">{{ conv.contactPhone }}</span>
          <div class="conv-flags">
            @if (conv.isOptedOut) {
              <span class="badge badge-opted-out">Opted Out</span>
            }
            <span class="message-count">{{ conv.messages.length }} msg{{ conv.messages.length === 1 ? '' : 's' }}</span>
          </div>
        </div>

        @if (conv.messages.length > 0) {
          <ul class="message-list" aria-label="Messages from {{ conv.contactPhone }}">
            @for (msg of conv.messages; track msg.id) {
              <li class="message-row">
                <span class="badge intent-{{ msg.intent.toLowerCase() }}">{{ msg.intent }}</span>
                <span class="msg-body">{{ msg.body }}</span>
                <span class="msg-meta">
                  {{ msg.receivedAt | date:'shortTime' }} · {{ msg.sender }}
                </span>
              </li>
            }
          </ul>
        }
      </li>
    }
  </ul>
</section>
